# Valorant Tournament Platform — Техническая спецификация проекта

## 1. Цель проекта

Создать прозрачную, честную и удобную платформу для проведения любительских и полупрофессиональных турниров по Valorant в СНГ. Платформа объединяет игроков, команды и организаторов и включает в себя турниры, скримы, систему внутриигровой валюты и рейтинги. Платформа не является социальной сетью — без личных сообщений, друзей и лайков.

## 2. Основная идея

Платформа обеспечивает полный цикл взаимодействия игроков и команд:

* Создание и настройка профиля игрока
* Формирование команд и участие в скримах
* Организация и участие в турнирах
* Отслеживание результатов, достижений и рейтингов

## 3. MVP (Минимальная версия для закрытого бета-теста)

**Цель MVP:** Создать рабочую платформу для тестовых турниров и получения фидбека от пользователей.

**Приоритетные функции:**
1. Настройка профиля
2. Создание команд и их настройка
3. Создание турниров и их настройка
4. Корректное автоматическое отображение турнирной сетки в зависимости от количества команд

### Профиль

* Регистрация и вход (email/password через Supabase)
* Настройка профиля игрока: ник, Riot ID, регион, описание, ссылки на соцсети, роли, агенты, ранги
* Загрузка аватара (необязательно): если аватар не загружен, отображаются инициалы или стандартная аватарка
* Поддержка всех рангов Valorant (Iron–Radiant)
* История участия в турнирах

### Команды

* Создание и управление командой
* Состав команды: минимум 1 игрок, максимум 10 игроков
* Игрок может быть только в одной команде одновременно
* Игрок может самостоятельно выйти из команды в любое время
* При создании команды пользователь автоматически становится капитаном
* Капитанство: в команде может быть только один капитан, капитан может передать капитанство другому игроку (требуется согласие нового капитана)
* Автоматическая передача капитанства: если капитан удаляет аккаунт, капитанство автоматически передается другому игроку
* Тренеры: неограниченное количество тренеров в команде, тренер может быть и игроком одновременно
* Права тренера: те же права, что у капитана, кроме удаления команды и передачи капитанства
* Приглашения в команду от капитана/тренера
* Подача заявки в команду со стороны игрока (если открыт набор)
* Настройка команды: название, логотип, описание, статус набора, требования к рангу/ролям
* Деактивация команды: если команда неактивна в течение 3 месяцев, она автоматически деактивируется (помечается как неактивная для видимости пользователям)

### Турниры

* Создание турниров с выбором формата: Single Elimination / Double Elimination
* Любой пользователь может создать турнир и становится организатором этого турнира
* Регистрация команд: капитан или тренер регистрирует команду на турнир, команда автоматически попадает в список участников
* Валидация при регистрации: проверка соответствия требованиям (минимальное количество игроков) происходит при регистрации
* Отмена регистрации: команда может отменить регистрацию на турнир до начала назначенного времени старта организатором
* Указание минимального количества игроков в команде для участия в турнире
* Генерация турнирной сетки: автоматическое распределение команд по сетке
* Редактирование турнира: возможно до начала турнира, после начала редактирование невозможно
* Запуск турнира: организатор может запустить турнир с меньшим количеством команд, чем указано в лимите
* Ввод результатов матчей: результаты вводит организатор (в будущем — автоматический ввод через ИИ по скриншоту)
* Автоматическое продвижение победителя по сетке
* Неявка команды: организатор решает на месте, что делать (автопоражение, дисквалификация и т.д.)
* Отмена турнира: при отмене турнира ничего не возвращается (призовой фонд, комиссия), должно быть предупредительное сообщение при создании турнира

### Система

* Внутренняя валюта (коины) — **НЕ в MVP, будет добавлена при реализации магазина:**
  * Создание турнира требует списания валюты (комиссия). Подписчикам — без комиссии
  * Призовой фонд формируется из личного баланса организатора
  * Способы заработка: участие в официальных турнирах, достижения и награды
  * Пополнение баланса: через платежную систему или вручную админом
  * Распределение призового фонда:
    * По умолчанию: 1 место — 60%, 2 место — 30%, 3 место — 10%
    * Организатор может настроить распределение при создании турнира
    * Минимум 3 места получают призы (для турниров с достаточным количеством участников)
    * Для турниров с меньшим количеством участников распределение корректируется автоматически
* Официальные турниры: турниры от платформы, спонсоров или коллабораций со стримерами. Всегда отображаются в начале страницы как "Избранный турнир". Статистика и лидерборд обновляются только по официальным турнирам
* Лидерборды: пока не реализуются в MVP, планируется собственная система рейтинга по турнирам платформы
* Админ может редактировать/удалять любые сущности, управлять всей платформой (нужен инструмент для админа)
* Скримы между командами:
  * Создание лобби для скрима: любой пользователь может создать лобби с указанием условий (не требуется команда или минимальное количество игроков)
  * Подача заявок на скримы: другие пользователи могут подавать заявки на скримы, создатель скрима может отправлять заявки другим пользователям
  * Результат скримов не требуется — скримы нужны только для поиска команд для тренировок под определенные условия
  * Скримы не влияют на рейтинг, это тренировочные матчи
* Уведомления: система уведомлений для заявок, приглашений, матчей и других важных событий

## 4. Будущие обновления (Post-MVP)

* Подписка и бонусы (будет добавлена при реализации магазина и валюты)
* Косметические элементы профиля
* Расширенная статистика игроков
* Верификация личности (аналог Faceit) через KYC
* Поиск тиммейтов по ролям и рангу
* Магазин и внутриигровые покупки
* Система валюты (коины) и призовых фондов
* Экспорт статистики (только для админов)

## 5. Организация турниров

* Указание формата: Single / Double Elimination
* Задание количества коинов в призовой фонд (из личного баланса) — **НЕ в MVP**
* Указание комиссии (списывается при запуске турнира) — **НЕ в MVP**
* Установка лимита команд
* Указание минимального количества игроков в команде для участия
* Настройка описания, регламента, BO формата (BO1–BO5), времени старта
* Использование шаблона регламента с возможностью редактирования
* Автоматическое распределение команд по сетке
* Организатор может запускать турнир только после установленного времени (или раньше, если все команды зарегистрированы)
* Регистрация команд: капитан или тренер регистрирует команду, команда автоматически попадает в список участников (с проверкой требований)
* Предупреждение при создании: организатор предупреждается, что при отмене турнира ничего не возвращается
* (В будущем) Автоматическое определение допуска команды: система будет проверять средний рейтинг команды и условия, указанные организатором

## 6. Роли пользователей

* Игрок — участвует в турнирах и скримах
* Капитан — управляет составом, принимает заявки, может исключать игроков, может передать капитанство, может удалить команду. В команде может быть только один капитан
* Тренер — имеет те же права, что и капитан, кроме удаления команды и передачи капитанства. Может быть и игроком одновременно. Неограниченное количество тренеров в команде
* Организатор — любой пользователь, создавший турнир, становится организатором этого турнира. Создает и управляет турнирами, вводит результаты матчей
* Админ — полный контроль над платформой. Может редактировать/удалять любые сущности, управлять пользователями, турнирами, валютой, жалобами. Может пополнять баланс пользователей вручную. Нужен инструмент для админа (панель администратора)
* Модератор (в будущем) — модерирует пользователей, заявки, жалобы
* Паблишер — публикует новости, анонсы, патч-ноуты Valorant, мету и т.д. Роль дается админом любому пользователю на платформе. Имеет свой инструмент для создания постов. Админ может редактировать и удалять посты паблишера

## 7. Турнирная сетка

* После ввода счёта организатором победитель автоматически продвигается по сетке (bracket_position)
* Проигравший выбывает или переходит в нижнюю сетку (при Double Elimination)
* (В будущем) Автоматический ввод результатов через ИИ: организатор загружает скриншот с результатом и статистикой, ИИ автоматически извлекает данные

## 8. Заявки в команды

* Если команда открыла набор — игрок может подать заявку
* Если набор закрыт — кнопка заявки скрыта
* Если игрок уже в команде — кнопка не отображается (игрок может быть только в одной команде)
* Капитан/тренер может указать требования (роль, минимальный ранг)
* Капитан/тренер может принять или отклонить заявку

## 9. Верификация и честность

* Обязательная привязка Riot ID
* Один аккаунт на email/телефон
* (В будущем) — верификация документов через KYC

## 10. Приложение: Страницы платформы

### MVP (приоритет)

* Главная: новости, активные турниры, расписание
* Команды: список, фильтры, страница команды (состав, статистика)
* Турниры: список, фильтры, страница турнира (сетка, участники, регламент)
* Профиль игрока: карточка с ролью, агентами, достижениями, статистикой, история участия в турнирах
* Скримы: поиск и создание тренировок между командами

### Post-MVP

* Лидерборд: рейтинг игроков и команд (планируется собственная система рейтинга по официальным турнирам)
* Магазин: PRO-подписка, косметика, активаторы VP
* Панель администратора: управление пользователями, турнирами, валютой, жалобами
* Панель паблишера: инструмент для создания постов (новости, анонсы, патч-ноуты)

## 11. Технологический стек

### Frontend

* **React 18** — UI библиотека
* **TypeScript** — типизация
* **Vite** — сборщик и dev-сервер
* **React Router DOM** — маршрутизация
* **Tailwind CSS** — стилизация
* **shadcn/ui** — UI компоненты (Radix UI)
* **React Hook Form** + **Zod** — формы и валидация
* **TanStack Query (React Query)** — управление состоянием сервера и кэширование
* **date-fns** — работа с датами
* **Lucide React** — иконки
* **Sonner** — уведомления (toast)

### Backend & Database

* **Supabase** — Backend as a Service:
  * PostgreSQL база данных
  * Row Level Security (RLS) для безопасности
  * Real-time подписки
  * Storage для файлов (аватары, логотипы)
  * Authentication (email/password)

### Интеграции (планируются)

* **Riot Games API** — получение данных игроков, рангов, статистики
* **Discord API** — интеграция с Discord (в будущем)
* **Google API** — OAuth авторизация (в будущем)

### Дополнительные инструменты

* **ESLint** — линтинг кода
* **PostCSS** + **Autoprefixer** — обработка CSS

## 12. Безопасность и права доступа

### Аутентификация

* Email/password через Supabase Auth
* Один аккаунт на email/телефон
* Обязательная привязка Riot ID для участия в турнирах
* В будущем: OAuth (Google, Discord)

### Авторизация и права доступа

* **Row Level Security (RLS)** в Supabase для защиты данных на уровне БД
* Роли пользователей определяют доступ к функциям:
  * Игрок: базовые права, участие в турнирах
  * Капитан: управление командой, регистрация на турниры
  * Тренер: те же права, что у капитана (кроме удаления команды и передачи капитанства)
  * Организатор: управление созданным турниром
  * Админ: полный доступ ко всем функциям
  * Паблишер: создание и редактирование постов

### Защита данных

* Валидация всех входных данных на клиенте и сервере
* Защита от SQL-инъекций через Supabase (параметризованные запросы)
* Защита от XSS через React (автоматическое экранирование)
* Ограничение размера загружаемых файлов
* Rate limiting для API (через Supabase)

## 13. Структура базы данных

Структура базы данных будет разработана с использованием Supabase MCP сервера. Основные сущности:

* **users** — пользователи (расширение auth.users)
* **profiles** — профили игроков
* **teams** — команды
* **team_members** — состав команд (игроки, капитаны, тренеры)
* **team_invitations** — приглашения в команды
* **team_applications** — заявки в команды
* **tournaments** — турниры
* **tournament_registrations** — регистрации команд на турниры
* **matches** — матчи
* **brackets** — турнирная сетка
* **scrims** — скримы
* **scrim_applications** — заявки на скримы
* **notifications** — уведомления
* **posts** — посты (новости, анонсы)
* **user_roles** — роли пользователей

Детальная структура будет создана через миграции Supabase.